# Frontend, backend e API

O backend é a parte da aplicação que não conseguimos ver. É o cérebro da aplicação (código que processa os dados) e sua memória (os dados, em geral em um banco de dados). 

Uma outra forma de ver o backend é como o atuador da experiência de frontend. O frontend da aplicação Web pode ser a página da Web mais bem trabalhada, mas se o backend não funcionar, a aplicação será falha. O backend é responsável por realizar ações de acordo com o que foi solicitado pelo usuário via frontend. 

No backend são realizados cálculos, lógica de negócios, interações com banco de dados e em geral é lá que ha bastante preocupação com desempenho (dependendo do que precisa ser feito). A maior parte do código necessário para que uma aplicação funcione será executada no backend. O código de backend é executado no servidor, em oposição ao cliente. Isso significa que os desenvolvedores de backend não precisam apenas entender linguagens de programação e bancos de dados, mas também devem ter uma compreensão da arquitetura do servidor. Se uma aplicação estiver lenta, travar com frequência ou gerar erros constantemente, provavelmente é devido a problemas de backend. É o desenvolvedor de backend que deve se preocupar com persistência dos dados, segurança da informação, performance, etc. O programador de backend deve estar familiarizado com a pilha de hardware/software que compõe o backend: servidor/OS, framework, aplicação, banco de dados. Em termos de opções de uso de tecnologias, o backend oferece muito mais variação do que o frontend (linguagens, tecnologias, serviços). Por exemplo, além de java podemos encontrar código de backend	desenvolvido em Python (Django),  Ruby (Rails), JavaScript (Node.js). Também é comum que o backend seja um conjunto de serviços (ou várias APIs que se comunicam - arquitetura de microsserviços) e nesse caso cada serviço pode fazer uso de linguagens e tecnologias diferentes.

Como a maior parte do código de uma aplicação é escrito no backend, ele deve ser fácil de entender e manter/atualizar. Neste curso escreveremos backend em Java, que é uma linguagem orientada a objetos. Assim, é importante que boas práticas de design OO (como [padrões para atribuição de responsabilidade](https://www.devmedia.com.br/desenvolvimento-com-qualidade-com-grasp/28704) e outros [padrões de projeto](https://refactoring.guru/design-patterns/catalog)) sejam seguidos. Baixo acoplamento entre entidades do software, alta coesão dentro uma classe (ou método) e manter responsabilidade com quem tem os dados continuam sendo regras fundamentais para a atribuição de responsabilidades.

O backend em geral expõe serviços em forma de APIs. APIs conectam software, aplicações, bancos de dados, e serviços juntos de forma transparente e coordenada. A API é uma interface de um serviço. O "cliente" do serviço (que pode ser outra API, o frontend, etc.) usa a API exposta pelo serviço para acessar o que precisa. O usuário de uma API é sempre outro programa (nunca um ser humano). Dizemos que a API determina um conjunto de instruções para acessar o serviço.

## Framework de desenvolvimento

A tarefa do backend é receber uma requisição HTTP, ler, identificar o que precisa ser feito e fazer. Isto envolve vários componentes, desde ler informações que vem do usuário passadas pelo frontend até a autenticação de usuários, verificação de permissões de acesso, leitura/escrita dos dados no banco de dados, calculos/processamento da informação, formação da resposta adequada a ser enviada de volta ao usuário (passada ao frontend). Essas atividades podem parecer simples na forma como são mencionadas, mas na verdade são bastante complexas e requerem toda uma orquestração de diversos serviços dentro do código do backend. Por exemplo, alguém precisa transformar o JSON recebido em um objeto dentro da aplicação backend para que possa ser manipulado. Processo inverso deve ocorrer ao enviar a resposta para o frontend. Alguém precisa empacotar tudo em uma resposta HTTP bem formada, com corpo, headers e código apropriados. Ao acessar dados é preciso levar em conta a natureza das bases de dados sendo acessadas para que a comunicação seja eficaz. Se vários clientes estiverem conectados ao servidor (backend) é preciso de alguma forma orquestrar quem vai ser atendido e quando, tendo estruturas de dados internas que possam gerenciar esse escalonamento.

Para nossa sorte existem diversos frameworks para desenvolvimento de backend que vão realizar pra gente a maioria das tarefas que são obrigatórias para todas as aplicações, como todas as que menciono acima. Neste curso usaremos o [spring boot](https://spring.io/projects/spring-boot).

De forma geral, o framework de desenvolvimento vai oferecer serviços genéricos que irão aumentar a produtividade do programador de backend. O programador deixa de se preocupar com atividades que são comuns a todas as aplicações, já que estas atividades são feitas pelo framework. O desenvolvedor apenas tem que saber ativar as ações corretas do framework, desenvolvendo a aplicação para o framework específico. Isso é algo ruim, pois a aplicação fica acoplada à API do framework escolhido. Por esta razão é bom usar frameworks que tenham chance de viver ainda por um bom tempo.

Como o framework vai realizar muitas tarefas importantes de forma transparente, o programador perde o controle sobre o que realmente está acontecendo. Isso pode dificultar um pouco o debugging, mas de forma geral usar o fraos poucos amework é vantajoso em termos de produtividade. Com a experiência de uso de um determinado framework o desenvolvedor começa a entender melhor os serviços oferecidos e como são realizados. Para isso é importante entender aos poucos os serviços oferecidos pelo frameowork, como sãaos poucos - não fazer por fazer, na tentativa e erro). Como o framework vai realizar muitas tarefas importantes de forma transparente, o programador perde um pouco o controle sobre o que realmente está acontecendo internamente. Isso pode dificultar um pouco o debugging, mas de forma geral usar o framework é vantajoso em termos de produtividade. Com a experiência de uso de um determinado framework o desenvolvedor começa a entender melhor os serviços oferecidos, como configurá-los e como esses serviços são realizados. Para isso é importante entender aos poucos os serviços oferecidos pelo framework, quando e como são  - não fazer por fazer, na tentativa e erro).

## Dependências 

O backend pode usar, além das bibliotecas do framework de desenvolvimento, outras bibliotecas já prontas. Tudo em nome de aumentar a produtividade, então não precisamos desenvolver do zero (_from scratch_) o que alguém já desenvolveu e testou. O próprio framework vai fazer uso de bibliotecas externas em muitas situações. Para facilitar a implantação (_deploy_) do código de backend nós usamos uma ferramenta que vai gerenciar as dependências desse software de backend. Neste curso vamos usar o  maven para controle de dependências.

Para entender mais detalhes leia [este artigo](https://www.devmedia.com.br/gerenciamento-de-dependencias-no-java/32811) já em português, bastante didático sobre a gerência de dependências em aplicações java.

## Organização do backend

O backend expõe serviços geralmente na forma de uma API (_Application Programming Interface_). A API vai definir que "funções" podem ser chamadas naquela aplicação, que informações de entrada são necessárias e como se dão as respostas de cada função dessas. A API dá acesso aos dados/serviços de forma controlada, expondo apenas o que deve ser exposto e com o cuidado de verificar se o usuário que requisita cada função tem autorização para o fazê-lo. Organizar o backend como uma (ou mais) API(s) permite diferentes “frontends” para a mesma aplicação backend. Além disso também permite criar aplicações a partir de outras aplicações, desde que elas também definam APIs (APIs que são clientes de outras APIs). A API padroniza o acesso aos dados/serviços de forma totalmente controlada e projetada.

As APIs podem ser bastante simples ou incrivelmente complexas, e existem diferentes maneiras de programar uma API. De forma bastante prática, podemos definir uma API como uma coleção de métodos claramente definidos para comunicação entre diferentes componentes de um software. Claro que ao definir métodos precisamos definir sua visibilidade, seus parâmetros de entrada e seu tipo de retorno. Pensar na API que queremos expor é a parte mais importante do desenvolvimento do backend e será alvo de estudos neste curso.

## API REST

Neste curso iremos focar no desenvolvimento de APIs REST - _Representational State Transfer_. A adoção de APIs REST é universalmente bem aceita e simplifica o entendimento da API uma vez que REST usa tecnologias/padrões já bem consolidados na Web para a comunicação entre cliente e servidor. Exemplos de tecnologias usadas: HTTP para comunicação entre processos, JSON ou XML para representar dados.

A API REST é baseada em URIs (_Uniform Resource Identifier_). Cada função oferecida está associada a uma URI bem definida. As respostas desta API vem em geral em um formato de dados específico chamado JSON (mas também pode ser HTML ou XML). 

Uma API REST segue alguns princípios, um dos mais importantes é que a interação cliente/API é _stateless_ (sem estado). Isto significa que cada requisição traz a informação necessária para que o servidor possa entendê-la e respondê-la. O estado das sessões fica sendo mantido apenas nos clientes, o que é bom para escalabilidade dos servidores. Por outro lado, esse tipo de interação usa mais mais rede já que certos dados precisam estar presentes em todas as requisições (como por exemplo, token de acesso do usuário). Para minimizar este problema alguns requisições podem usar cache no cliente. Estas requisições são  "cacheáveis". Poder ser mantida em cache no cliente pode não ser opção para as requisições que tem conteúdo muito dinâmico e requerem sempre a busca no servidor para receber dados atuais ou personalizados (requisições não "cacheáveis"). Usar cache melhora desempenho, mas pode prejudicar confiabilidade (dados velhos).

Em se tratando de API REST, um **recurso** é uma abstração sobre um determinado tipo de informação que a API gerencia. Por exemplo, no contexto de comércio eletrônico, podemos ter recursos tais como produtos, clientes, vendas, etc. Em REST todo recurso deve possuir uma identificação únicapara diferenciar qual dos recursos deve ser manipulado em uma determinada solicitação. Essa identificação do recurso é feita por URI (Uniform Resource Identifier). 

O design de uma API REST consiste em pensar nos recursos que serão expostos (em termos de URIs) e de seus parâmetros de entrada e informações de saída. Existem regras de boas práticas para que este design seja realizado de forma elegante. A parte mais importante (ou uma das mais importantes) do trabalho de um desenvolvedor de backend é projetar boas APIs. Uma API que seja fácil de entender, usar e manter é sempre desejável. 

Vejamos com um exemplo simples um pouco do que é pensar no design de uma API: imagine que você está desenvolvendo uma API para um restaurante italiano que quer começar a fazer entregar. Um dos pratos a serem entregues é de parmegiana (que pode ser de filé, frango ou peixe), e que também inclui tamanhos variados. Existem várias formas de programar isso. Por exemplo, podemos pensar nas URIs GET /parmegiana-file-grande, GET /parmegiana-file-media, … e GET /parmegiana-peixe-pequena. Outra forma de pensar na API seria ter um recurso GET /parmegianas e passar informações específicas sobre o pedido na forma de dados em JSON no corpo da requisição. Qual dessas formas parece ser a mais simples e a mais indicada?

Uma API Web é a interface criada pelo back-end: a coleção de endpoints e recursos que esses endpoints expoem

### Um exemplo de API REST

A Câmara dos Deputados oferece um serviço para qualquer pessoa interessada obter dados da Câmara. Trata-se de uma API REST chamada [Dados abertos](https://dadosabertos.camara.leg.br/swagger/api.html). Ao abrir a documentação da API neste link é  possível conhecer as chamadas aceitas pela API, que tipo de dado deve vir no corpo das mensagens, como são as respostas de cada chamada, dentre outras informações. 

